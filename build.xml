<project name="webtex">
	<property name="project.version" value="0.3.7"/>
	<property name="war" value="${ant.project.name}.war"/>
	
	<fileset id="files.lib" dir="lib">
		<include name="*.jar"/>
	</fileset>
	<fileset id="external.lib" dir="../common/infosys/java/lib">
	    <include name="infosysutil-0.13.jar"/>
	</fileset>

    <tstamp>
        <format property="project.lastchangedate" pattern="yyyy-MM-dd"/>
    </tstamp>
	
	<target name="compile">
		<echo message="About to compile sources using ${ant.version}" level="info"/>
		<delete dir="WebContent/WEB-INF/classes/se"/>
		<mkdir dir="WebContent/WEB-INF/classes/se"/>
		<javac srcdir="src" destdir="WebContent/WEB-INF/classes" debug="on" encoding="ISO8859_1" target="1.5">
			<classpath>
				<fileset refid="files.lib"/>
				<fileset refid="external.lib"/>
			</classpath>
		</javac>
	</target>
	
	<target name="properties">
		<filter token="PROJECT_VERSION" value="${project.version}"/>
		<copy todir="WebContent/WEB-INF/classes" filtering="true" overwrite="true">
		    <fileset dir="src">
		        <include name="*.properties"/>
		    </fileset>
		</copy>
	</target>
	
	<target name="libs">
		<copy todir="WebContent/WEB-INF/lib" overwrite="true">
		    <fileset refid="external.lib"/>
		</copy>
	</target>
	
	<target name="texini">
		<echo message="Building tex format"/>
		<exec dir="WebContent/WEB-INF/secsty" executable="/usr/bin/tex">
			<arg value="--ini"/>
			<arg value="secplain.sty"/>
		</exec>
		<echo message="Creating ls-R"/>
		<exec dir="WebContent/WEB-INF/secsty" executable="texhash">
			<arg value="."/>
		</exec>
	</target>
	
	<target name="war" depends="compile, properties, libs, texini" description="Build the war file">
		<delete file="${war}"/>
		<echo message="About to build ${war} using ${ant.version}" level="info"/>
		<war destfile="${war}" duplicate="fail" webxml="WebContent/WEB-INF/web.xml">
			<classes dir="WebContent/WEB-INF/classes">
                <include name="**/*.class"/>
			    <include name="**/*.properties"/>
			</classes>
			<fileset dir="WebContent">
				<exclude name="WEB-INF/web.xml"/>
				<exclude name="WEB-INF/classes/**"/>
			</fileset>
		</war>
	</target>
	
	<target name="build-dist" depends="war" description="Build the distribution">
		<zip destfile="dist/${ant.project.name}-${project.version}.zip">
			<fileset dir="" includes="${war}"/>
			<fileset dir="doc" includes="releasenotes.txt"/>
			<fileset dir="doc" includes="README.txt"/>
		</zip>
	</target>
	
	<target name="hudson" depends="compile" description="Build stuff without touching TeX bits">
		<delete file="${war}"/>
		<echo message="About to build ${war} using ${ant.version}" level="info"/>
		<war destfile="${war}" duplicate="fail" webxml="WebContent/WEB-INF/web.xml">
			<classes dir="WebContent/WEB-INF/classes">
				<include name="**/*.class"/>
			</classes>
			<fileset dir="WebContent">
				<exclude name="WEB-INF/web.xml"/>
				<exclude name="WEB-INF/classes/**"/>
			</fileset>
		</war>
	</target>
</project>